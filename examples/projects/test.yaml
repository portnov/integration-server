title: Test project
owner: portnov

directory: /home/portnov/src/integration-server/test/

host-by-environment:
  home: lenovo
  work: local
  virtual: lenny32

nginx-conf-path:
  production: /etc/nginx/sites-enabled/
  $$: .

hosts:
  local:
    host: localhost
    port: 22
    login: portnov
    path: /home/portnov/temp/test/
    known-hosts: /home/portnov/.ssh/known_hosts
    public-key:  /home/portnov/.ssh/id_rsa.pub
    private-key: /home/portnov/.ssh/id_rsa

  lenovo:
    host: lenovo.local
    port: 2345
    path: /home/this/temp/test/
    known-hosts: /home/portnov/.ssh/known_hosts
    public-key:  /home/portnov/.ssh/id_rsa.pub
    private-key: /home/portnov/.ssh/id_rsa

  lenny32:
    type: vm
    host: debian32
    login: portnov
    path: /home/portnov/
    known-hosts: /home/portnov/.ssh/known_hosts
    public-key:  /home/portnov/.ssh/id_rsa.pub
    private-key: /home/portnov/.ssh/id_rsa
    empty: false
    startup-time: 20
    template: template.xml
    name: Debian32

phases:
  test:
    where: lenny32
    actions: ls
    executor: raw
    parser: all-ok

  count:
    where: ${host-by-environment[environment]}
    actions: /home/portnov/bin/count ${count?7}
    executor: raw
    parser: all-ok

  build:
    where: ${host-by-environment[environment]}
    actions: [all, clean]

    domain: example.com
    ENV: LANG=C

    create-files:
      nginx.site.conf: ${nginx-conf-path[target]}/${domain}.conf

    executor: make
    parser: ghc

